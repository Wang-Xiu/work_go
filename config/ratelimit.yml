# 限流器配置文件
# 支持KMS加密敏感信息（如Redis密码）

# 是否启用限流功能
enabled: true

# Redis配置（用于分布式环境下的限流）
redis:
  host: localhost
  port: 6379
  # Redis密码 - 使用KMS加密
  # 格式: kms://加密后的密文
  # 如果不需要密码，留空即可
  # 示例（使用Mock KMS加密"mypassword"后的密文）: kms://drowssapym
  password: "kms://drowssapym"  # 这是"mypassword"的Mock加密（仅示例）
  db: 0
  pool_size: 10
  min_idle_conns: 5
  max_retries: 3
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s

# 限流规则列表
rules:
  # API接口 - 每秒10次，每分钟100次
  - path: "/api/*"
    limit_per_second: 10
    limit_per_minute: 100
    burst_size: 20  # 允许20次突发请求

  # 登录接口 - 严格限流（防暴力破解）
  - path: "/api/login"
    limit_per_second: 1
    limit_per_minute: 5
    burst_size: 2

  # 注册接口 - 严格限流（防刷）
  - path: "/api/register"
    limit_per_second: 1
    limit_per_minute: 3
    burst_size: 1

  # 支付回调 - 宽松限流（保证高可用）
  - path: "/callback/payment/*"
    limit_per_second: 100
    limit_per_minute: 1000
    burst_size: 200

  # 管理后台 - 中等限流
  - path: "/admin/*"
    limit_per_second: 20
    limit_per_minute: 200
    burst_size: 40

  # 查询接口 - 仅限制每分钟
  - path: "/api/query/*"
    limit_per_second: 0  # 0表示不限制每秒
    limit_per_minute: 60
    burst_size: 120

# 默认规则（当路径不匹配任何规则时使用）
# 如果不配置，则不匹配的路径不限流
default_rule:
  path: "*"
  limit_per_second: 5
  limit_per_minute: 50
  burst_size: 10
